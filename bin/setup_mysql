#!/usr/bin/env bash
# =====================================================
# MySQL Database Setup Script for Blog Application
# =====================================================

set -e

echo "üöÄ Setting up MySQL database for Blog Application..."

# Check if MySQL is running
if ! command -v mysql &> /dev/null; then
    echo "‚ùå MySQL is not installed. Please install MySQL first."
    exit 1
fi

# Test MySQL connection
if ! mysql -u root -e "SELECT 1;" &> /dev/null; then
    echo "‚ùå Cannot connect to MySQL as root user without password."
    echo "Please ensure MySQL is running and root user has no password."
    echo ""
    echo "To fix this, run:"
    echo "mysql -u root -p"
    echo "ALTER USER 'root'@'localhost' IDENTIFIED BY '';"
    echo "FLUSH PRIVILEGES;"
    echo "exit"
    exit 1
fi

echo "‚úÖ MySQL connection successful"

# Create databases
echo "üì¶ Creating databases..."
mysql -u root < db/quick_mysql_setup.sql

# Run migrations
echo "üîÑ Running database migrations..."
bundle exec rails db:migrate

# Load seed data
echo "üå± Loading seed data..."
bundle exec rails db:seed

# Verify setup
echo "üîç Verifying database setup..."
mysql -u root < db/verify_mysql_setup.sql

echo ""
echo "üéâ MySQL database setup completed successfully!"
echo ""
echo "üìä Summary:"
echo "  - Databases created: blog_application_development, blog_application_test"
echo "  - Tables migrated: ‚úÖ"
echo "  - Sample data loaded: ‚úÖ"
echo ""
echo "üöÄ You can now start the Rails server with:"
echo "  rails server"
echo ""
echo "üîë Default login credentials:"
echo "  Admin: admin@example.com / password123"
echo "  User 1: john@example.com / password123"
echo "  User 2: jane@example.com / password123"
